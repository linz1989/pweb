KindEditor.plugin("filemanager",function(e){function i(e,i,n){return e+" ("+Math.ceil(i/1024)+"KB, "+n+")"}function n(e,n){n.is_dir?e.attr("title",n.filename):e.attr("title",i(n.filename,n.filesize,n.datetime))}var a=this,l="filemanager",t=e.undef(a.fileManagerJson,a.basePath+"php/file_manager_json.php"),o=a.pluginsPath+l+"/images/",r=a.lang(l+".");a.plugin.filemanagerDialog=function(i){function d(i,n,l){var o="path="+i+"&order="+n+"&dir="+v;_.showLoading(a.lang("ajaxLoading")),e.ajax(e.addParam(t,o+"&"+(new Date).getTime()),function(e){_.hideLoading(),l(e)})}function s(i,n,a,l){var t=e.formatUrl(a.id),o=encodeURIComponent(n.current_dir_path+a.filename+"/");a.is_dir?i.click(function(e){d(o,T.val(),l)}):a.is_photo?i.click(function(e){g.call(this,t,a.filename)}):i.click(function(e){g.call(this,t,a.filename)}),I.push(i)}function c(i,n){function a(){"VIEW"==C.val()?d(i.current_dir_path,T.val(),m):d(i.current_dir_path,T.val(),p)}e.each(I,function(){this.unbind()}),y.unbind(),C.unbind(),T.unbind(),i.current_dir_path&&y.click(function(e){d(i.moveup_dir_path,T.val(),n)}),C.change(a),T.change(a),w.html("")}function p(i){c(i,p);var n=document.createElement("table");n.className="ke-table",n.cellPadding=0,n.cellSpacing=0,n.border=0,w.append(n);for(var a=i.file_list,l=0,t=a.length;l<t;l++){var d=a[l],m=e(n.insertRow(l));m.mouseover(function(i){e(this).addClass("ke-on")}).mouseout(function(i){e(this).removeClass("ke-on")});var f=o+(d.is_dir?"folder-16.gif":"file-16.gif"),u=e('<img src="'+f+'" width="16" height="16" alt="'+d.filename+'" align="absmiddle" />'),v=e(m[0].insertCell(0)).addClass("ke-cell ke-name").append(u).append(document.createTextNode(" "+d.filename));!d.is_dir||d.has_file?(m.css("cursor","pointer"),v.attr("title",d.filename),s(v,i,d,p)):v.attr("title",r.emptyFolder),e(m[0].insertCell(1)).addClass("ke-cell ke-size").html(d.is_dir?"-":Math.ceil(d.filesize/1024)+"KB"),e(m[0].insertCell(2)).addClass("ke-cell ke-datetime").html(d.datetime)}}function m(i){c(i,m);for(var a=i.file_list,l=0,t=a.length;l<t;l++){var d=a[l],p=e('<div class="ke-inline-block ke-item"></div>');w.append(p);var f=e('<div class="ke-inline-block ke-photo"></div>').mouseover(function(i){e(this).addClass("ke-on")}).mouseout(function(i){e(this).removeClass("ke-on")});p.append(f);var u=i.current_url+d.filename,v=d.is_dir?o+"folder-64.gif":d.is_photo?u:o+"file-64.gif",h=e('<img src="'+v+'" width="80" height="80" alt="'+d.filename+'" />');!d.is_dir||d.has_file?(f.css("cursor","pointer"),n(f,d),s(f,i,d,m)):f.attr("title",r.emptyFolder),f.append(h)}}var f=e.undef(i.width,650),u=e.undef(i.height,510),v=e.undef(i.dirName,""),h=e.undef(i.viewType,"VIEW").toUpperCase(),g=i.clickFn,k=['<div style="padding:10px 20px;">','<div class="ke-plugin-filemanager-header">','<div class="ke-left">','<img class="ke-inline-block" name="moveupImg" src="'+o+'go-up.gif" width="16" height="16" border="0" alt="" /> ','<a class="ke-inline-block" name="moveupLink" href="javascript:;">'+r.moveup+"</a>","</div>",'<div class="ke-right">',r.viewType+' <select class="ke-inline-block" name="viewType">','<option value="VIEW">'+r.viewImage+"</option>",'<option value="LIST">'+r.listImage+"</option>","</select> ",r.orderType+' <select class="ke-inline-block" name="orderType">','<option value="NAME">'+r.fileName+"</option>",'<option value="SIZE">'+r.fileSize+"</option>",'<option value="TYPE">'+r.fileType+"</option>","</select>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-plugin-filemanager-body"></div>',"</div>"].join(""),_=a.createDialog({name:l,width:f,height:u,title:a.lang(l),body:k}),b=_.div,w=e(".ke-plugin-filemanager-body",b),y=(e('[name="moveupImg"]',b),e('[name="moveupLink"]',b)),C=(e('[name="viewServer"]',b),e('[name="viewType"]',b)),T=e('[name="orderType"]',b),I=[];return C.val(h),d("",T.val(),"VIEW"==h?m:p),_}});