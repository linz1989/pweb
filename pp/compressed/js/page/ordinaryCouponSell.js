require(["css!../../compressed/css/page/"+$$.rootVm.page+".css?"+$$.rootVm.currTime,"daterangepicker","!domReady"],function(){function t(){if(""==i.currStatus)i.dataList=c;else for(var t=[],a=0;a<c.length;a++)c[a].actStatus==i.currStatus&&t.push(c[a]),i.dataList=t}function a(){$.ajax({url:"act/list",success:function(a){200==a.statusCode&&(a=a.respData,c=a.coupons||[],t(),avalon.scan(n[0]))}})}var e,o,s=$$.rootVm.page+"Ctrl"+ +new Date,n=$("#"+$$.rootVm.page+"Page"),c=[],r=$("#confirmModal"),u=$("#confirmModal>div>div.content"),d=$("#qrCodeModal>div>div.content>img");n.attr("ms-controller",s),$$.currPath.html("营销中心 >> 优惠券");var i=avalon.define({$id:s,dataList:[],statusObj:[{name:"全部状态",value:""},{name:"使用中",value:"online"},{name:"未上线",value:"not_online"},{name:"已下线",value:"downline_can_use"},{name:"已过期",value:"ne_lose_efficacy"},{name:"已失效",value:"disable"}],currStatus:"",doChangeStatus:function(){i.currStatus=this.value,t()},showQrCode:function(t,a){t?(d[0].src=t,o.show()):$.ajax({url:"act/qrcode",data:{id:a},success:function(t){200==t.statusCode?(d[0].src=t.respData,o.show()):msgAlert("未能成功生成二维码！")}})},doChangeCouponStatus:function(t,a,o){var s="online"==o?"上线":"delete"==o?"删除":"下线";r.attr("opeType",o),r.attr("actId",t),r.attr("actType",a),u.text("确定要"+s+"此优惠券？"),e.show()},doCopyCoupon:function(t,e){$.ajax({url:"act/copy",data:{id:t,operator:"copy",actType:e},success:function(t){200==t.statusCode?(msgAlert(t.msg,!0),a()):msgAlert(t.msg||"操作失败！")}})},doHandlerPopCoupon:function(t){$.ajax({url:"act/assigned_index",data:{id:t},success:function(t){200==t.statusCode?(msgAlert(t.msg,!0),a()):msgAlert(t.msg||"操作失败！")}})}});e=new Modal(r,{doClickOkBtn:function(){e.close(),$.ajax({url:"act/modify",data:{actId:r.attr("actId"),operator:r.attr("opeType"),actType:r.attr("actType")},success:function(t){200==t.statusCode?(msgAlert(t.msg,!0),a()):msgAlert(t.msg||"操作失败！")}})}}),o=new Modal($("#qrCodeModal")),a()});