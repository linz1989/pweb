require(["css!../../compressed/css/page/"+$$.rootVm.page+".css?"+$$.rootVm.currTime,"!domReady"],function(){function e(){return i.val()?/^1[34578]\d{9}$/.test(i.val())?c.val()?!!/^([1-9][0-9]*|(([1-9]\d*|0)\.[0-9]{0,2})|0)$/g.test(c.val())||(l.showTip("请输入正确的金额(最多两位小数)！"),c.focus(),!1):(l.showTip("请输入金额！"),c.focus(),!1):(l.showTip("请输入正确的手机号码！"),i.focus(),!1):(l.showTip("请输入手机号码！"),i.focus(),!1)}function a(){e()&&$.ajax({url:"club/finacial/user/recharge/save",type:"post",dataType:"json",data:{amount:100*parseFloat(c.val()),remark:h.val(),telephone:i.val()},success:function(e){"200"==e.statusCode?(t(),c.val(""),h.val(""),msgAlert("充值成功。",!0),l.close()):msgAlert("充值失败："+e.msg)}})}function t(e,a,t){o=e=e||1,$.ajax({url:"club/finacial/user/deal/list",data:{page:e,pageSize:u,businessCategory:"line_recharge",showOperator:"Y"},success:function(a){200==a.statusCode&&(d.dataList=a.respData,s.refresh({currPage:e,totalPage:a.pageCount}),avalon.scan(r[0]))}})}var s,l,n=$$.rootVm.page+"Ctrl"+ +new Date,r=$("#"+$$.rootVm.page+"Page"),u=20,o=1,i=$("#rechargeAcct"),c=$("#rechargeMoney"),h=$("#rechargeRemark"),v="",g={consume:"账户消费",user_recharge:"线上充值",pay_for_other:"请客核销",line_recharge:"线下充值"};r.attr("ms-controller",n),$$.currPath.html("结算中心 >> 现金充值"),avalon.filters.bizTypeFilter=function(e){return g[e]||""};var d=avalon.define({$id:n,dataList:[],showModal:function(){l.show()}});s=new Pagination($("#dataListPagination"),{switchPage:function(e){t(e)}}),l=new Modal($("#rechargeModal"),{doClickOkBtn:function(){a()}}),i.on("input",function(){/\D/.test(this.value)&&(this.value=this.value.replace(/\D/g,"")),1==this.value.length&&1!=this.value&&(this.value=""),2!=this.value.length||/^1[34578]$/.test(this.value)||(this.value=1),this.value.length>11&&(this.value=this.value.substring(0,11))}),c.on("input",function(){if(""==c[0].value)v.length>1?c[0].value=v:v="";else{var e=c[0].value.match(/\./g);e&&c[0].value.match(/\./g).length>1&&(c[0].value=c[0].value.substring(0,c[0].value.length-1)),/^([1-9][0-9]*|(([1-9]\d*|0)\.[0-9]{0,2})|0)$/g.test(c[0].value)?v=c[0].value:c[0].value=v}}),$("#dataListTable>table>thead>tr:eq(0)>th>div>select").on("change",function(){u=this.value,t()}),t()});