require(["css!../../compressed/css/page/"+$$.rootVm.page+".css?"+$$.rootVm.currTime,"daterangepicker","!domReady"],function(){function a(a,t,o){n=a=a||1;var u=formatDateRangeVal(i.val()),d=t||u.start,l=o||u.end;$.ajax({url:"info/orderData",type:"post",data:{startTime:d,endTime:l,page:a,pageSize:s,serialNo:$("#search-serial").val(),status:c.currStatus},success:function(t){t.respData&&(c.dataList=t.respData,e.refresh({currPage:a,totalPage:t.pageCount}),avalon.scan(r[0]))}})}var e,t=$$.rootVm.page+"Ctrl"+ +new Date,r=$("#"+$$.rootVm.page+"Page"),s=20,n=1,i=$("#dataListTable>table>thead>tr.search>th>div.time>input"),o=$("#dataListTable>table>thead>tr.search>th>div.time>a");r.attr("ms-controller",t),$$.currPath.html("<a href='#!/home'>首页</a> >> 订单列表");var c=avalon.define({$id:t,dataList:[],statusObj:[{value:"",name:"所有状态"},{value:"complete",name:"已完成"},{value:"submit",name:"待接受"},{value:"accept",name:"已接受"},{value:"reject",name:"已拒绝"},{value:"failure",name:"失效"},{value:"overtime",name:"超时"}],paidOrderSwitch:"off",currStatus:"",doChangeStatusQuery:function(){c.currStatus=this.value,a()},doSearchQuery:function(){a()},doHandlerUsePaidOrder:function(e,t,r){$.ajax({url:"api/v2/manager/user/paid_order/use",data:{id:e,processType:t,orderNo:r},success:function(e){200==e.statusCode?(msgAlert("verified"==t?"使用成功！":"操作成功！",!0),a(n)):msgAlert(e.msg||"操作失败！")}})}}),u=new Date,d=new Date;u.setTime(u.getTime()-2592e6),i.daterangepicker({startDate:u,endDate:d},function(e,t){o.removeClass("active"),a(1,e.format("YYYY-MM-DD"),t.format("YYYY-MM-DD"))}),e=new Pagination($("#dataListPagination"),{switchPage:function(e){a(e)}}),$.ajax({url:"api/v2/manager/paid_order/open_status",success:function(e){200==e.statusCode?(e=e.respData,e.payAppointment="Y"==e.payAppointment?"on":"off","on"==e.payAppointment&&"on"==e.openStatus&&(c.paidOrderSwitch="on"),a()):e.msg&&msgAlert(e.msg)}}),$("#dataListTable>table>thead>tr:eq(0)>th>div>select").on("change",function(){s=this.value,a()}),o.click(function(){var e=$(this);if(!e.hasClass("active")){e.siblings().removeClass("active"),e.addClass("active");var t=e.attr("type");if("all"!=t){var r=new Date;r.setTime(r.getTime()-24*parseInt(t)*60*60*1e3),i.data("daterangepicker").setStartDate(r),i.data("daterangepicker").setEndDate(new Date)}else i.val("");a()}})});