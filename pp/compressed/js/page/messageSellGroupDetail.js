require(["css!../../compressed/css/page/"+$$.rootVm.page+".css?"+$$.rootVm.currTime,"jqform","!domReady"],function(){function e(e){i.currPage=e=e||1,$.ajax({url:"contact/details",data:{page:e,pageSize:i.pageSize,groupId:u,phoneNum:$("#telInput").val()},success:function(t){200==t.statusCode?(i.groupName=t.respData.group.name,t.respData=t.respData.details||[],i.records=t.respData,a.refresh({currPage:e,totalPage:t.pageCount}),avalon.scan(l[0])):msgAlert(t.msg||"数据查询失败！")}}),avalon.scan(l[0])}var a,t,o,s=$$.rootVm.page+"Ctrl"+ +new Date,l=$("#"+$$.rootVm.page+"Page"),n=$("#groupNameInput"),r=$("#telInput"),u=getParamObj("id");u||(msgAlert("页面访问参数错误！"),history.back()),l.attr("ms-controller",s),$$.currPath.html("营销中心 >> <a href='#!/messageSell'>短信营销 >> <a href='#!/messageSellGroups'>分组管理</a> >> 分组详情</a>");var i=avalon.define({$id:s,pageSize:20,currPage:1,records:[],groupName:"",delRecord:function(e){$("#confirmDelTelModal>div>div.confirmDel").text("确定要删除这个手机号码：'"+e+"'？").attr("tel",e),t.show()},doChangePageSize:function(){i.pageSize=this.value,e()}});a=new Pagination($("#dataListPagination"),{switchPage:function(a){e(a)}}),n.on("input",function(){this.value.length>15&&(this.value=this.value.substr(0,15))}),$("#telInput").on("input",function(){/\D/.test(this.value)&&(this.value=this.value.replace(/\D/g,"")),this.value.length>11&&(this.value=this.value.substring(0,11)),"telInput"==this.id&&(/^1[34578]\d{9}$/.test(this.value)?$("#groupAddTelBtn").removeClass("disabled"):$("#groupAddTelBtn").addClass("disabled"))}),$("#groupAddTelBtn").click(function(){return 0==r.val().length?void r.focus():/^1[34578]\d{9}$/.test(r.val())?void $.ajax({url:"contact/addPhone",data:{groupId:u,phoneNum:r.val()},success:function(a){200==a.statusCode?(msgAlert(a.msg||"操作成功！",!0),r.val(""),e()):msgAlert(a.msg||"操作失败！")}}):(msgAlert("新增的手机号码不正确！"),void r.focus())}),$("#groupSearchTelBtn").click(function(){e()}),$("#groupNameEditBtn").click(function(){n.val(i.groupName),o.show()}),t=new Modal($("#confirmDelTelModal"),{doClickOkBtn:function(){t.close(),$.ajax({url:"contact/deletePhone",data:{groupId:u,phoneNum:$("#confirmDelTelModal>div>div.confirmDel").attr("tel")},success:function(a){200==a.statusCode?(msgAlert(a.msg||"删除成功！",!0),e()):msgAlert(a.msg||"删除失败！")}})}}),o=new Modal($("#editGroupNameModal"),{doClickOkBtn:function(){return 0==n.val().length?void n.focus():(o.loading(),void $.ajax({url:"contact/update",type:"post",data:{groupId:u,groupName:n.val()},success:function(e){o.loading("hide"),200==e.statusCode?(msgAlert(e.msg||"保存成功！",!0),i.groupName=n.val(),o.close(),n.val("")):msgAlert(e.msg||"保存失败！")}}))}}),e()});