require(["css!../../compressed/css/page/couponRecord.css?"+$$.rootVm.currTime,"daterangepicker","!domReady"],function(){function a(a,e,c){a=a||1;var r=formatDateRangeVal(o.val()),l=e||r.start,d=c||r.end;$.ajax({url:"act/coupon_get_data",type:"post",data:{startDate:l,endDate:d,page:a,pageSize:n,actId:i.selectCouponId},success:function(e){200==e.statusCode&&(i.dataList=e.respData,t.refresh({currPage:a,totalPage:e.pageCount}),avalon.scan(s[0]))}})}var t,e=$$.rootVm.page+"Ctrl"+ +new Date,s=$("#"+$$.rootVm.page+"Page"),n=20,o=$("#dataListTable>table>thead>tr.search>th>div.time>input"),c=$("#dataListTable>table>thead>tr.search>th>div.time>a");s.attr("ms-controller",e),$$.currPath.html("数据统计 >> <a href='#!/ordinaryCouponDataStatistics'>优惠券</a> >> 优惠券领取记录");var i=avalon.define({$id:e,dataList:[],selectCouponId:"",couponSelectData:[],switchCoupon:function(){i.selectCouponId=this.value,a()}}),r=new Date,l=new Date;r.setTime(r.getTime()-2592e6),o.daterangepicker({startDate:r,endDate:l},function(t,e){c.removeClass("active"),a(1,t.format("YYYY-MM-DD"),e.format("YYYY-MM-DD"))}),t=new Pagination($("#dataListPagination"),{switchPage:function(t){a(t)}}),$.ajax({url:"club/datastatistics/get_club_coupon_ids",success:function(a){if(200==a.statusCode){var t=[{actId:"",actTitle:"全部优惠券",couponTypeName:""}];a=a.respData;for(var e=0;e<a.length;e++)a[e].couponTypeName&&(a[e].actTitle=a[e].actTitle+"("+a[e].couponTypeName+")"),t.push(a[e]);i.couponSelectData=t}else a.msg&&msgAlert(a.msg)}}),$("#dataListTable>table>thead>tr:eq(0)>th>div>select").on("change",function(){n=this.value,a()}),c.click(function(){var t=$(this);if(!t.hasClass("active")){t.siblings().removeClass("active"),t.addClass("active");var e=t.attr("type");if("all"!=e){var s=new Date;s.setTime(s.getTime()-24*parseInt(e)*60*60*1e3),o.data("daterangepicker").setStartDate(s),o.data("daterangepicker").setEndDate(new Date)}else o.val("");a()}}),a()});