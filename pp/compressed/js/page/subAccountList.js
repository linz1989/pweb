require(["!domReady"],function(){function e(){$.ajax({url:"profile/subuser/list",success:function(e){e.respData&&(r.dataList=e.respData,avalon.scan(l[0]))}})}function a(){return i.val()&&i.val().trim()?"edit"==r.opeType||u.val()?!(n.val()&&!/^1[34578]\d{9}$/.test(n.val()))||(t.showTip("请输入正确的手机号码！"),n.focus(),!1):(t.showTip("请输入账号密码！"),u.focus(),!1):(t.showTip("请输入登录名！"),i.focus(),!1)}var t,s=$$.rootVm.page+"Ctrl"+ +new Date,l=$("#"+$$.rootVm.page+"Page"),i=$("#loginName"),u=$("#loginPassword"),o=$("#accountName"),n=$("#accountTel");l.attr("ms-controller",s),$$.currPath.html("资料设置 >> <a href='#!/accountCenter'>会所资料</a> >> 会所子账号管理");var r=avalon.define({$id:s,dataList:[],modelHeaderStr:"",opeType:"",currId:"",doAddAccount:function(){r.modelHeaderStr="新增账号",r.opeType="add",r.currId="",i.val(""),u.val(""),o.val(""),n.val(""),t.show()},doEditAccount:function(e){var a=r.dataList[e];r.currId=a.id,r.modelHeaderStr="编辑账号",r.opeType="edit",i.val(a.loginName),u.val(""),o.val(a.name),n.val(a.phoneNum),t.show()},doChangeAccountPw:function(e){var a=r.dataList[e];r.currId=a.id,r.modelHeaderStr="修改账号密码",r.opeType="changePw",i.val(a.loginName),u.val(""),o.val(a.name),n.val(a.phoneNum),t.show()}});t=new Modal($("#editAccountModal"),{doClickOkBtn:function(){a()&&("add"==r.opeType||"edit"==r.opeType?(t.loading(),$.ajax({url:"profile/subuser/save",type:"post",data:{id:r.currId,loginName:i.val().trim(),name:o.val().trim(),phoneNum:n.val(),plainPassword:u.val()},success:function(a){t.loading("hide"),200==a.statusCode?(t.close(),msgAlert(a.msg,!0),e()):t.showTip(a.msg)}})):(t.loading(),$.ajax({url:"profile/subuser/password/update",type:"post",data:{id:r.currId,plainPassword:u.val()},success:function(e){t.loading("hide"),200==e.statusCode?(t.close(),msgAlert(e.msg,!0)):t.showTip(e.msg)}})))}}),i.on("input",function(){this.value.length>15&&(this.value=this.value.substr(0,15)),/\s/.test(this.value)&&(this.value=this.value.replace(/\s/g,""))}),u.on("input",function(){this.value.length>15&&(this.value=this.value.substr(0,15)),/\s/.test(this.value)&&(this.value=this.value.replace(/\s/g,""))}),o.on("input",function(){this.value.length>30&&(this.value=this.value.substr(0,30)),/\s/.test(this.value)&&(this.value=this.value.replace(/\s/g,""))}),n.on("input",function(){/\D/.test(this.value)&&(this.value=this.value.replace(/\D/g,"")),1==this.value.length&&1!=this.value&&(this.value=""),2!=this.value.length||/^1[34578]$/.test(this.value)||(this.value=1),this.value.length>11&&(this.value=this.value.substring(0,11))}),e()});