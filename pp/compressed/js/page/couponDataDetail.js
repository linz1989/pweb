require(["css!../../compressed/css/page/"+$$.rootVm.page+".css?"+$$.rootVm.currTime,"daterangepicker","!domReady"],function(){function t(t,a,n){t=t||1;var i=formatDateRangeVal(r.val()),u=a||i.start,l=n||i.end;$.ajax({url:"club/datastatistics/redpacket_share_use_get_data",type:"post",data:{startDate:u,endDate:l,page:t,pageSize:o,actId:c.selectCouponId,orderName:c.orderName,ascDesc:c.sortType,techInfo:$("#techInfoSearch").val(),techPhone:$("#techTelSearch").val()},success:function(a){if(200==a.statusCode){var o,r=[],n=[];for(o=0;o<a.respData.length;o++)"合计:"==a.respData[o].nickNameAndNo?r[1]=a.respData[o]:"其它方式"==a.respData[o].nickNameAndNo?r[0]=a.respData[o]:n.push(a.respData[o]);c.dataList=n,r[0]&&r[1]?c.countDataList=r:c.countDataList=[],e.refresh({currPage:t,totalPage:a.pageCount}),avalon.scan(s[0])}}})}var e,a=$$.rootVm.page+"Ctrl"+ +new Date,s=$("#"+$$.rootVm.page+"Page"),o=20,r=$("#dataListTable>table>thead>tr.search>th>div.time>input");s.attr("ms-controller",a),$$.currPath.html("数据统计 >> <a href='#!/ordinaryCouponDataStatistics'>优惠券</a> >> 优惠券数据详情");var c=avalon.define({$id:a,dataList:[],countDataList:[],selectCouponId:"",couponSelectData:[],orderName:"",sortType:"",switchCoupon:function(){c.selectCouponId=this.value,t()},doClickSearch:function(){t()}}),n=new Date,i=new Date;n.setTime(n.getTime()-2592e6),r.daterangepicker({startDate:n,endDate:i},function(e,a){t(1,e.format("YYYY-MM-DD"),a.format("YYYY-MM-DD"))}),e=new Pagination($("#dataListPagination"),{switchPage:function(e){t(e)}}),$.ajax({url:"club/datastatistics/get_club_coupon_ids",success:function(t){if(200==t.statusCode){var e=[{actId:"",actTitle:"全部优惠券",couponTypeName:""}];t=t.respData;for(var a=0;a<t.length;a++)t[a].couponTypeName&&(t[a].actTitle=t[a].actTitle+"("+t[a].couponTypeName+")"),e.push(t[a]);c.couponSelectData=e}else t.msg&&msgAlert(t.msg)}}),$("#dataListTable>table>thead>tr:eq(0)>th>div>select").on("change",function(){o=this.value,t()}),$("#techTelSearch").on("input",function(){/\D/.test(this.value)&&(this.value=this.value.replace(/\D/g,"")),this.value.length>11&&(this.value=this.value.substr(0,11))}),$("#sortHeader>th>a").click(function(){c.sortType="desc"==this.getAttribute("sortType")?"asc":"desc",c.orderName=this.getAttribute("sortName"),this.setAttribute("sortType",c.sortType),t()}),t()});